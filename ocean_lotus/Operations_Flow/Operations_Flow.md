# OceanLotus Operations Flow

![Diagram of the below word picture](../Resources/images/OperationsFLowBlackBG.jpeg)


| Step | CTI Operations Flow | Cited Intelligence |
| ------- | ----------- | ----------- | 
|0| Assuming OceanLotus used a watering hole attack ([T1189](https://attack.mitre.org/techniques/T1189/)), Hope Potter, downloadeds a macOS application disguised Word document ([T1566](https://attack.mitre.org/techniques/T1566/)). This document, conkylan.app, now resides in the `/Downloads` folder on Hope Potter's macOS Catalina Host. | OceanLotus has compromised websites tied to Vietnamese individuals, bordering countries‚Äô state owned or affiliated organizations, and organizations that are critical of the Vietnamese Government. The compromised websites are leveraged to execute targeted malicious JavaScript code (Framework B) which is then later used to distribute malware.<sup>1</sup>
|1| Thinking it's a normal Word document, the user, Hope Potter (hpotter), double-clicks the conkylan.app ([T1204.002](https://attack.mitre.org/techniques/T1204/002/))(note: We were not able to disguise the app as a Word document using a homoglyph file extension due to OS updates üôå üçé). The Word document is actually an Application bundle ([T1036](https://attack.mitre.org/techniques/T1036/007/)), the first stage payload, which executes the second stage payload([T1027.009](https://attack.mitre.org/techniques/T1027/009/)), deploys a decoy Word document, and connects to the C2 server. Using the script, OceanLotus also installs persistence via Launch Agent ([T1543.001](https://attack.mitre.org/techniques/T1543/001/)) and removes file information used by security tools ([T1070](https://attack.mitre.org/techniques/T1070/)). | Prior to exfiltration, the adversary uses a combination of byte scrambling and AES encryption on the collected data. The AES256 key is also scrambled using XOR and ROL 6. <sup> 7 </sup> </p>APT32 changes the permission of a file it wants to execute to 755. <sup> 7 </sup> </p> Upon installation, OceanLotus's second-stage payload modifies the timestamp of the backdoor files using the `touch` command. <sup> 5, 6, 7 </sup>
|2| Once OceanLotus has compromised the target machine, it employs lateral movement to move to the internal Linux server using SSH keys ([T1021.004](https://attack.mitre.org/techniques/T1021/004/)) and the known_hosts file ([T1018](https://attack.mitre.org/techniques/T1018/)). | The attacker performs OS fingerprinting on the target machine. <sup> 11 </sup>
|3| The Rotajakiro backdoor is deployed to collect and exfiltrate data. To establish persistence, RotaJakiro creates autostart scripts ([T1547](https://attack.mitre.org/techniques/T1547/)) in different locations in the user‚Äôs file system depending on if they have root access. The implant uses a combination of AES, XOR, ROTATE encryption and ZLIB compression for C2 communications ([T1573](https://attack.mitre.org/techniques/T1573/)) and AES encryption to obfuscate its tools ([T1027](https://attack.mitre.org/techniques/T1027/)). It also utilizes process guarding to revive processes if necessary ([T1053](https://attack.mitre.org/techniques/T1053/)).| OceanLotus and RotaJakiro use the same ROTATE and XOR procedure when encrypting their payloads. <sup> 9, 15 </sup> </p> RotaJakiro uses magic bytes in the Head of their payloads. <sup> 14, 15 </sup> </p> RotaJakiro dynamically generates a table of constants required by the AES encryption algorithm to prevent the algorithm from being directly identified. <sup> 9 </sup> </p> RotaJakiro uses a custom binary protocol on TCP port 443 using HTTPS to avoid traditional firewalls. <sup> 9, 14 </sup>
|4| OceanLotus remains quiet in the network and removes traces/indicators of compromise ([T1070](https://attack.mitre.org/techniques/T1070/)). The group continues to discover, collect and exfiltrate data and perform more extensive enumeration ([T1558](https://attack.mitre.org/techniques/T1558/)).| The adversay‚Äôs malware can import Kerberos tickets, which could play an integral role in enumeration across the network. <sup> 12 </sup>




# References
[1] [OceanLotus Blossoms: Mass Digital Surveillance and Attacks Targeting ASEAN, Asian Nations, the Media, Human Rights Groups, and Civil Society](https://www.volexity.com/blog/2017/11/06/oceanlotus-blossoms-mass-digital-surveillance-and-exploitation-of-asean-nations-the-media-human-rights-and-civil-society/) </br>
[2] [OceanLotus: Extending Cyber Espionage Operations Through Fake Websites](https://www.volexity.com/blog/2020/11/06/oceanlotus-extending-cyber-espionage-operations-through-fake-websites/) </br>
[3] [The New and Improved macOS Backdoor from OceanLotus](https://unit42.paloaltonetworks.com/unit42-new-improved-macos-backdoor-oceanlotus/) </br>
[4] [APT32 Multi-stage macOS Trojan Innovates on Crimeware Scripting Technique](https://www.sentinelone.com/labs/apt32-multi-stage-macos-trojan-innovates-on-crimeware-scripting-technique/) </br>
[5] [New MacOS Backdoor Connected to OceanLotus Surfaces](https://www.trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html) </br>
[6] [OceanLotus: macOS malware update](https://www.welivesecurity.com/2019/04/09/oceanlotus-macos-malware-update/) </br>
[7] [New MacOS Backdoor Linked to OceanLotus Found](https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html) </br>
[8] [Operation Cobalt Kitty: Attackers‚Äô Arsenal](https://www.cybereason.com/hubfs/Cybereason%20Labs%20Analysis%20Operation%20Cobalt%20Kitty-Part2.pdf) </br>
[9] [RotaJakiro: A long live secret backdoor with 0 VT detection](https://blog.netlab.360.com/stealth_rotajakiro_backdoor_en/) </br>
[10] [Operation Cobalt Kitty: A large-scale APT in Asia carried out by the OceanLotus Group](https://www.cybereason.com/blog/operation-cobalt-kitty-apt) </br>
[11] [Operation Cobalt Kitty: Attack Lifecycle](https://www.cybereason.com/hubfs/Cybereason%20Labs%20Analysis%20Operation%20Cobalt%20Kitty-Part1.pdf) </br>
[12] [Cyber Espionage is Alive and Well: APT32 and the Threat to Global Corporations](https://www.mandiant.com/resources/blog/cyber-espionage-apt32) </br>
[13] [OceanLotus: New watering hole attack in Southeast Asia](https://www.welivesecurity.com/2018/11/20/oceanlotus-new-watering-hole-attack-southeast-asia/) </br>
[14] [The New and Improved macOS Backdoor from OceanLotus](https://unit42.paloaltonetworks.com/unit42-new-improved-macos-backdoor-oceanlotus/) </br>
[15] [RotaJakiro, the Linux version of the OceanLotus](https://blog.netlab.360.com/rotajakiro_linux_version_of_oceanlotus/) </br>
[16] [OceanLotus APT Hits Human Rights Orgs in Vietnam, China, Cambodia](https://www.digitalguardian.com/blog/oceanlotus-apt-hits-human-rights-orgs-vietnam-china-cambodia) </br>
